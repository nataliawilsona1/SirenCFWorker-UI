<!DOCTYPE html>
<html lang="en" id="html" class="scroll-auto scrollbar-hide dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proxy List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .scrollbar-hide::-webkit-scrollbar { display: none; }
      .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
      @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
      .glass-effect {
        background-color: rgba(42, 42, 47, 0.6);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 224, 183, 0.3);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .glass-effect-light {
        background-color: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 224, 183, 0.2);
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
    </style>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"
    ></script>
    <script>
      tailwind.config = {
        darkMode: 'selector',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Poppins', 'sans-serif'],
            },
            colors: {
              'primary-dark': '#1c1c20',
              'secondary-dark': '#2a2a2f',
              'text-light': '#f0f0f5',
              'accent-cyan': '#00e0b7',
              'accent-blue': '#4a90e2',
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-primary-dark font-sans text-text-light bg-fixed relative">
    <div class="fixed inset-0 z-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 opacity-75"></div>

    <div
      id="notification-badge"
      class="fixed z-50 opacity-0 transition-opacity ease-in-out duration-300 mt-9 mr-6 right-0 p-4 max-w-sm rounded-xl flex items-center gap-x-4 shadow-lg glass-effect"
    >
      <div class="shrink-0">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          class="size-6 text-accent-cyan"
        >
          <path
            d="M5.85 3.5a.75.75 0 0 0-1.117-1 9.719 9.719 0 0 0-2.348 4.876.75.75 0 0 0 1.479.248A8.219 8.219 0 0 1 5.85 3.5ZM19.267 2.5a.75.75 0 1 0-1.118 1 8.22 8.22 0 0 1 1.987 4.124.75.75 0 0 0 1.48-.248A9.72 9.72 0 0 0 19.266 2.5Z"
          />
          <path
            fill-rule="evenodd"
            d="M12 2.25A6.75 6.75 0 0 0 5.25 9v.75a8.217 8.217 0 0 1-2.119 5.52.75.75 0 0 0 .298 1.206c1.544.57 3.16.99 4.831 1.243a3.75 3.75 0 1 0 7.48 0 24.583 24.583 0 0 0 4.83-1.244.75.75 0 0 0 .298-1.205 8.217 8.217 0 0 1-2.118-5.52V9A6.75 6.75 0 0 0 12 2.25ZM9.75 18c0-.034 0-.067.002-.1a25.05 25.05 0 0 0 4.496 0l.002.1a2.25 2.25 0 1 1-4.5 0Z"
            clip-rule="evenodd"
          />
        </svg>
      </div>
      <div>
        <div class="text-md font-bold text-accent-cyan">Berhasil!</div>
        <p class="text-sm text-gray-300">Akun berhasil disalin</p>
      </div>
    </div>

    <!-- SIDEBAR FLAGS DINAMIS -->
    <div class="h-full fixed top-0 w-16 z-20 overflow-y-scroll scrollbar-hide shadow-lg glass-effect">
      <div id="sidebar-flags" class="text-2xl flex flex-col items-center h-full gap-2 py-4">
        <!-- Flags will be injected here -->
      </div>
    </div>

    <div class="ml-16 flex flex-col items-center min-h-screen relative z-10 p-4">
      <div class="rounded-xl p-4 text-right w-full mb-6 shadow-lg glass-effect">
        <div class="flex justify-end gap-3 text-sm flex-wrap text-gray-300">
          <p id="container-info-ip">IP: 127.0.0.1</p>
          <p id="container-info-country">Country: Singapore</p>
          <p id="container-info-isp">ISP: Localhost</p>
        </div>
      </div>

      <div id="container-title" class="sticky top-0 py-6 w-full max-w-7xl z-10 text-center glass-effect-light rounded-xl mb-6">
        <h1 class="text-2xl font-semibold text-text-light">
          Welcome to <span class='text-indigo-500 font-semibold'>Nautica</span>
        </h1>
      </div>

      <div class="flex flex-col md:flex-row gap-6 pt-10 w-full max-w-7xl justify-center">
        <!-- BAGIAN INI YANG DINAMIS -->
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6" id="proxy-list-container">
          <!-- Proxy cards will be injected here -->
        </div>
      </div>

      <nav
        id="container-pagination"
        class="w-full max-w-7xl mt-8 sticky bottom-0 z-20 transition-transform -translate-y-6"
      >
        <ul class="flex justify-center space-x-4">
          <li><button disabled class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white font-semibold border-2 border-neutral-800 rounded-lg transition-colors" onclick=navigateTo('/sub/0')>Prev</button></li>
          <li><button  class="px-4 py-2 bg-indigo-500 hover:bg-indigo-600 disabled:bg-slate-400 dark:disabled:bg-slate-600 text-white font-semibold border-2 border-neutral-800 rounded-lg transition-colors" onclick=navigateTo('/sub/1')>Next</button></li>
        </ul>
      </nav>
    </div>

    <footer>
      <div class="fixed bottom-4 right-4 flex flex-col gap-3 z-50">
        <a href="https://raw.githubusercontent.com/dit1304/Cloud/main/qris.jpeg" target="_blank">
          <button
            class="transition-colors rounded-full p-3 block text-white shadow-lg transform hover:scale-105 bg-accent-blue hover:bg-opacity-80"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 24 24"
              fill="currentColor"
              class="size-6"
            >
              <path
                d="M10.464 8.746c.227-.18.497-.311.786-.394v2.795a2.252 2.252 0 0 1-.786-.393c-.394-.313-.546-.681-.546-1.004 0-.323.152-.691.546-1.004ZM12.75 15.662v-2.824c.347.085.664.228.921.421.427.32.579.686.579.991 0 .305-.152.671-.579.991a2.534 2.534 0 0 1-.921.42Z"
              />
              <path
                fill-rule="evenodd"
                d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v.816a3.836 3.836 0 0 0-1.72.756c-.712.566-1.112 1.35-1.112 2.178 0 .829.4 1.612 1.113 2.178.502.4 1.102.647 1.719.756v2.978a2.536 2.536 0 0 1-.921-.421l-.879-.66a.75.75 0 0 0-.9 1.2l.879.660c.533.4 1.169.645 1.821.75V18a.75.75 0 0 0 1.5 0v-.81a4.124 4.124 0 0 0 1.821-.749c.745-.559 1.179-1.344 1.179-2.191 0-.847-.434-1.632-1.179-2.191a4.122 4.122 0 0 0-1.821-.75V8.354c.29.082.559.213.786.393l.415.33a.75.75 0 0 0 .933-1.175l-.415-.33a3.836 3.836 0 0 0-1.719-.755V6Z"
                clip-rule="evenodd"
              />
            </svg>
          </button>
        </a>
        <button
          onclick="toggleWildcardsWindow()"
          class="transition-colors rounded-full p-3 text-white shadow-lg block transform hover:scale-105 bg-accent-blue hover:bg-opacity-80"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 text-text-light"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M9 9V4.5M9 9H4.5M9 9 3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5 5.25 5.25"
            />
          </svg>
        </button>
        <button
          onclick="toggleDarkMode()"
          class="transition-colors rounded-full p-3 text-white shadow-lg transform hover:scale-105 bg-accent-cyan hover:bg-opacity-80"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6 text-text-light"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"
            ></path>
          </svg>
        </button>
      </div>
    </footer>

    <!-- Script dinamis flags & proxylist -->
    <script>
      // Ambil kode negara dari query string (?cc=PL)
      const urlParams = new URLSearchParams(window.location.search);
      let proxyCountry = urlParams.get('cc') || "PL";
      let availableCountries = [];

      async function loadSidebarFlags(data) {
        const sidebar = document.getElementById('sidebar-flags');
        sidebar.innerHTML = '';
        availableCountries = Object.keys(data);

        availableCountries.forEach(cc => {
          const a = document.createElement('a');
          a.href = `/sub?cc=${cc}`;
          a.className = "py-1";
          a.innerHTML = `<img width=20 src="https://hatscripts.github.io/circle-flags/flags/${cc.toLowerCase()}.svg" />`;
          sidebar.appendChild(a);
        });
      }

      async function loadProxyList(data) {
        const proxies = data[proxyCountry] || [];
        const container = document.getElementById('proxy-list-container');
        container.innerHTML = '';

        if (proxies.length === 0) {
          container.innerHTML = `<div class="col-span-full text-center text-red-400">No proxy found for country code <b>${proxyCountry}</b></div>`;
          return;
        }

        proxies.forEach((proxy, idx) => {
          const [ip, port] = proxy.split(':');
          const card = document.createElement('div');
          card.className = "lozad scale-95 mb-4 bg-white dark:bg-slate-800 transition-all duration-300 rounded-lg p-6 flex flex-col shadow-md hover:shadow-lg border border-slate-200 dark:border-slate-700 hover:scale-105";
          card.innerHTML = `
            <div id="countryFlag" class="absolute -translate-y-11 -translate-x-2 border-4 border-white dark:border-slate-800 rounded-full overflow-hidden">
              <img width="48" src="https://hatscripts.github.io/circle-flags/flags/${proxyCountry.toLowerCase()}.svg" />
            </div>
            <div class="flex-grow">
              <div id="ping-${idx}" class="animate-pulse text-xs font-semibold text-slate-500 dark:text-slate-400 text-right">Idle ${proxy}</div>
            </div>
            <div class="rounded-lg py-4 px-4 bg-slate-50 dark:bg-slate-700/50 flex-grow mt-4">
              <h5 class="font-bold text-lg text-slate-800 dark:text-slate-100 mb-1 overflow-x-scroll scrollbar-hide text-nowrap">Proxy Server</h5>
              <div class="text-slate-600 dark:text-slate-300 text-sm">
                <p>IP: ${ip}</p>
                <p>Port: ${port}</p>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      async function loadAll() {
        try {
          const res = await fetch('https://raw.githubusercontent.com/FoolVPN-ID/Nautica/refs/heads/main/kvProxyList.json');
          if (!res.ok) throw new Error('proxylist.json not found');
          const data = await res.json();

          // Update sidebar flags
          await loadSidebarFlags(data);

          // Jika cc di query tidak ada di proxylist.json, pakai country pertama
          if (!data[proxyCountry]) {
            proxyCountry = Object.keys(data)[0];
            // Update URL tanpa reload
            window.history.replaceState({}, '', `?cc=${proxyCountry}`);
          }

          // Update grid proxy
          await loadProxyList(data);
        } catch (e) {
          document.getElementById('proxy-list-container').innerHTML = `<div class="col-span-full text-center text-red-400">Gagal load proxylist.json</div>`;
        }
      }

      window.addEventListener('DOMContentLoaded', loadAll);
    </script>

    <script>
      // Shared
      const rootDomain = "nautica.zerostore.tech";
      const notification = document.getElementById("notification-badge");
      const windowContainer = document.getElementById("container-window");
      const windowInfoContainer = document.getElementById("container-window-info");
      const converterUrl =
        "https://script.google.com/macros/s/AKfycbwwVeHNUlnP92syOP82p1dOk_-xwBgRIxkTjLhxxZ5UXicrGOEVNc5JaSOu0Bgsx_gG/exec";
    
      // Switches
      let isDomainListFetched = false;
    
      // Local variable
      let rawConfig = "";
    
      function getDomainList() {
        if (isDomainListFetched) return;
        isDomainListFetched = true;
    
        windowInfoContainer.innerText = "Fetching data...";
    
        const url = "https://" + rootDomain + "/api/v1/domains/get";
        const res = fetch(url).then(async (res) => {
          const domainListContainer = document.getElementById("container-domains");
          domainListContainer.innerHTML = "";
    
          if (res.status == 200) {
            windowInfoContainer.innerText = "Done!";
            const respJson = await res.json();
            for (const domain of respJson) {
              const domainElement = document.createElement("p");
              domainElement.classList.add("w-full", "bg-amber-400", "rounded-md");
              domainElement.innerText = domain;
              domainListContainer.appendChild(domainElement);
            }
          } else {
            windowInfoContainer.innerText = "Failed!";
          }
        });
      }
    
      function registerDomain() {
        const domainInputElement = document.getElementById("new-domain-input");
        const rawDomain = domainInputElement.value.toLowerCase();
        const domain = domainInputElement.value + "." + rootDomain;
    
        if (!rawDomain.match(/\w+\.\w+$/) || rawDomain.endsWith(rootDomain)) {
          windowInfoContainer.innerText = "Invalid URL!";
          return;
        }
    
        windowInfoContainer.innerText = "Pushing request...";
    
        const url = "https://" + rootDomain + "/api/v1/domains/put?domain=" + domain;
        const res = fetch(url).then((res) => {
          if (res.status == 200) {
            windowInfoContainer.innerText = "Done!";
            domainInputElement.value = "";
            isDomainListFetched = false;
            getDomainList();
          } else {
            if (res.status == 409) {
              windowInfoContainer.innerText = "Domain exists!";
            } else {
              windowInfoContainer.innerText = "Error " + res.status;
            }
          }
        });
      }
    
      function copyToClipboard(text) {
        toggleOutputWindow();
        rawConfig = text;
      }
    
      function copyToClipboardAsRaw() {
        navigator.clipboard.writeText(rawConfig);
    
        notification.classList.remove("opacity-0");
        setTimeout(() => {
          notification.classList.add("opacity-0");
        }, 2000);
      }
    
      async function copyToClipboardAsTarget(target) {
        windowInfoContainer.innerText = "Generating config...";
        const url = "https://api.foolvpn.me/convert";
        const res = await fetch(url, {
          method: "POST",
          body: JSON.stringify({
            url: rawConfig,
            format: target,
            template: "cf",
          }),
        });
    
        if (res.status == 200) {
          windowInfoContainer.innerText = "Done!";
          navigator.clipboard.writeText(await res.text());
    
          notification.classList.remove("opacity-0");
          setTimeout(() => {
            notification.classList.add("opacity-0");
          }, 2000);
        } else {
          windowInfoContainer.innerText = "Error " + res.statusText;
        }
      }
    
      function navigateTo(link) {
        window.location.href = link + window.location.search;
      }
    
      function toggleOutputWindow() {
        windowInfoContainer.innerText = "Select output:";
        toggleWindow();
        const rootElement = document.getElementById("output-window");
        if (rootElement.classList.contains("hidden")) {
          rootElement.classList.remove("hidden");
        } else {
          rootElement.classList.add("hidden");
        }
      }
    
      function toggleWildcardsWindow() {
        windowInfoContainer.innerText = "Domain list";
        toggleWindow();
        getDomainList();
        const rootElement = document.getElementById("wildcards-window");
        if (rootElement.classList.contains("hidden")) {
          rootElement.classList.remove("hidden");
        } else {
          rootElement.classList.add("hidden");
        }
      }
    
      function toggleWindow() {
        if (windowContainer.classList.contains("hidden")) {
          windowContainer.classList.remove("hidden");
        } else {
          windowContainer.classList.add("hidden");
        }
      }
    
      function toggleDarkMode() {
        const rootElement = document.getElementById("html");
        if (rootElement.classList.contains("dark")) {
          rootElement.classList.remove("dark");
        } else {
          rootElement.classList.add("dark");
        }
      }
    
      function checkProxy() {
        for (let i = 0; ; i++) {
          const pingElement = document.getElementById("ping-"+i);
          if (pingElement == undefined) return;
    
          const target = pingElement.textContent.split(" ").filter((ipPort) => ipPort.match(":"))[0];
          if (target) {
            pingElement.textContent = "Checking...";
          } else {
            continue;
          }
    
          let isActive = false;
          new Promise(async (resolve) => {
            const res = await fetch("https://nautica.zerostore.tech/check?target=" + target)
              .then(async (res) => {
                if (isActive) return;
                if (res.status == 200) {
                  pingElement.classList.remove("dark:text-white");
                  const jsonResp = await res.json();
                  if (jsonResp.proxyip === true) {
                    isActive = true;
                    pingElement.textContent = "Active " + jsonResp.delay + " ms " + "(" + jsonResp.colo + ")";
                    pingElement.classList.add("text-green-600");
                  } else {
                    pingElement.textContent = "Inactive";
                    pingElement.classList.add("text-red-600");
                  }
                } else {
                  pingElement.textContent = "Check Failed!";
                }
              })
              .finally(() => {
                resolve(0);
              });
          });
        }
      }
    
      function checkRegion() {
        for (let i = 0; ; i++) {
          const containerRegionCheck = document.getElementById("container-region-check-" + i);
          const configSample = document.getElementById("config-sample-" + i)?.value.replaceAll(" ", "");
          if (containerRegionCheck == undefined) break;
    
          const res = fetch(
            "https://api.foolvpn.me/regioncheck?config=" + encodeURIComponent(configSample)
          ).then(async (res) => {
            if (res.status == 200) {
              containerRegionCheck.innerHTML = "<hr>";
              for (const result of await res.json()) {
                containerRegionCheck.innerHTML += "<p>" + result.name + ": " + result.region + "</p>";
              }
            }
          });
        }
      }
    
      function checkGeoip() {
        const containerIP = document.getElementById("container-info-ip");
        const containerCountry = document.getElementById("container-info-country");
        const containerISP = document.getElementById("container-info-isp");
        const res = fetch("https://" + rootDomain + "/api/v1/myip").then(async (res) => {
          if (res.status == 200) {
            const respJson = await res.json();
            containerIP.innerText = "IP: " + respJson.ip;
            containerCountry.innerText = "Country: " + respJson.country;
            containerISP.innerText = "ISP: " + respJson.asOrganization;
          }
        });
      }
    
      window.onload = () => {
        checkGeoip();
        checkProxy();
        // checkRegion();
        const observer = lozad(".lozad", {
          load: function (el) {
            el.classList.remove("scale-95");
          },
        });
        observer.observe();
      };
    
      window.onscroll = () => {
        const paginationContainer = document.getElementById("container-pagination");
    
        if (window.innerHeight + Math.round(window.scrollY) >= document.body.offsetHeight) {
          paginationContainer.classList.remove("-translate-y-6");
        } else {
          paginationContainer.classList.add("-translate-y-6");
        }
      };
    </script>
    
  </body>
</html>
